/**
 * Estilos para Tom Select - EXACT MATCH con el formulario underlined
 * Copia exactamente los estilos del formulario existente
 */

// Contenedor principal de Tom Select - usa estilo underlined minimalista
.ts-wrapper {
  width: 100% !important;
  
  // FUENTE IDÉNTICA AL FORMULARIO - usar la misma clase que el contenedor
  @apply font-segoe;
  
  // Campo de selección - idéntico a los selects normales del formulario
  .ts-control {
    // Layout y dimensiones (copiado de _fields.scss)
    @apply w-full;
    
    // Interacción (copiado de _fields.scss)
    @apply cursor-pointer outline-none appearance-none;
    
    // Bordes - UNDERLINED STYLE (copiado de _fields.scss)
    @apply border-0 border-b border-gray-300 rounded-none;
    
    // Espaciado (copiado de _fields.scss)
    @apply px-1 py-2;
    
    // Colores y fondo (copiado de _fields.scss)
    @apply bg-transparent text-gray-900;
    
    // Animaciones (copiado de _fields.scss)
    @apply transition-all duration-300 ease-in-out;
    
    // Override conflictos (copiado de _fields.scss)
    @apply rounded-none shadow-none;
    @apply border-0 border-b border-solid;
    
    // Altura mínima igual que los inputs
    min-height: 2.5rem;
    height: auto;
    
    // Input de búsqueda dentro del control
    .ts-control-input {
      // FUENTE IDÉNTICA AL FORMULARIO
      @apply font-segoe text-base font-normal;
      @apply bg-transparent text-gray-900 placeholder-gray-400;
      @apply outline-none border-0;
      line-height: 1.5;
      
      &::placeholder {
        @apply text-gray-400;
      }
    }
    
    // Texto seleccionado (single select)
    .ts-input {
      // FUENTE IDÉNTICA AL FORMULARIO
      @apply font-segoe text-base font-normal;
      @apply bg-transparent text-gray-900;
      @apply outline-none border-0;
      line-height: 1.5;
    }
    
    // Items seleccionados (para multi-select, aunque no lo usemos)
    .ts-item {
      @apply font-segoe text-base font-normal;
      @apply bg-primary-50 text-primary-700;
      @apply px-2 py-1 rounded;
    }
    
    // Botón de limpiar - estilo elegante y minimalista
    .ts-control-clear {
      @apply absolute right-8 top-1/2 transform -translate-y-1/2;
      @apply text-gray-400 hover:text-gray-600 hover:bg-gray-100;
      @apply cursor-pointer rounded-full;
      @apply w-5 h-5 flex items-center justify-center;
      @apply transition-all duration-200 ease-in-out;
      @apply text-sm font-medium;
      line-height: 1;
      
      &::before {
        content: "×";
        @apply text-base leading-none;
      }
      
      // Estado activo
      &:active {
        @apply bg-gray-200 scale-95;
      }
    }
  }
  
  // Estado de foco - IDÉNTICO al formulario
  &.focus .ts-control,
  &.dropdown-active .ts-control {
    // Interacción focus (copiado de _fields.scss)
    @apply outline-none;
    
    // Reset estilos focus (copiado de _fields.scss)
    @apply bg-transparent rounded-none shadow-none;
    
    // Borde focus - UNDERLINED AZUL (copiado de _fields.scss)
    @apply border-b-2 border-primary;
  }
  
  // Estado hover
  &:hover:not(.focus):not(.dropdown-active) .ts-control {
    @apply border-gray-400;
  }
  
  // Estado disabled
  &.disabled .ts-control {
    @apply text-gray-400 border-gray-200 cursor-not-allowed;
    @apply bg-gray-50;
  }
}

// Dropdown de opciones - minimalista y limpio
.ts-dropdown {
  @apply border border-gray-200 rounded-none shadow-lg;
  @apply bg-white;
  border-top: none;
  
  // FUENTE IDÉNTICA AL FORMULARIO
  @apply font-segoe;
  
  // Contenedor de opciones
  .ts-dropdown-content {
    @apply max-h-96 overflow-y-auto;
    
    // Cada opción
    .ts-option {
      @apply px-3 py-2 cursor-pointer;
      @apply text-gray-900;
      @apply border-b border-gray-50;
      
      // FUENTE Y TAMAÑO IDÉNTICOS AL FORMULARIO
      @apply font-segoe text-base font-normal;
      line-height: 1.5;
      
      &:last-child {
        @apply border-b-0;
      }
      
      // Estado hover
      &:hover {
        @apply bg-gray-50;
      }
      
      // Estado seleccionado/highlighted
      &.active {
        @apply bg-primary text-white;
      }
      
      // Opción seleccionada actualmente
      &.selected {
        @apply bg-primary-50 text-primary-700;
      }
    }
  }
  
  // Mensaje cuando no hay resultados
  .ts-no-results {
    @apply px-3 py-4 text-center;
    @apply text-gray-500 italic text-sm;
  }
}

// Estilos específicos para colegios (minimalista)
.college-dropdown {
  .college-option {
    .college-name {
      @apply font-normal text-gray-900;
      line-height: 1.4;
    }
  }
}

// Responsividad - mismo enfoque que el formulario
@media (max-width: 768px) {
  .ts-wrapper {
    .ts-control {
      // Altura ligeramente mayor en móviles
      min-height: 2.75rem;
      
      .ts-control-input,
      .ts-input {
        // Font size 16px para evitar zoom en iOS
        font-size: 1rem;
      }
    }
  }
  
  .ts-dropdown {
    .ts-dropdown-content .ts-option {
      @apply px-4 py-3;
      font-size: 1rem;
    }
  }
}

// Integración perfecta con el formulario
.form-modules {
  .field {
    .ts-wrapper {
      width: 100% !important;
    }
  }
  
  // Estados de error y validación - idénticos al formulario
  .ts-wrapper.error .ts-control,
  .field.error .ts-wrapper .ts-control {
    @apply rounded-none appearance-none;
    @apply border-red-500 bg-red-50;
    
    &.focus {
      @apply rounded-none;
      @apply border-red-600 bg-red-50;
    }
  }
  
  .ts-wrapper.validated .ts-control,
  .field.validated .ts-wrapper .ts-control {
    @apply rounded-none appearance-none;
    @apply border-green-600 bg-green-50;
    
    &.focus {
      @apply rounded-none;
      @apply border-green-600 bg-green-50;
    }
  }

  // Mensaje de error específico para Tom Select
  .error-message {
    @apply text-red-500 text-sm mt-1;
    @apply font-segoe;
  }

  // Indicador de carga para scroll infinito
  .loading {
    @apply text-gray-500 text-sm p-3 text-center;
    @apply font-segoe italic;
    @apply border-t border-gray-200;
    background: linear-gradient(90deg, transparent, rgba(0,0,0,0.1), transparent);
    animation: loading-shimmer 1.5s infinite;
  }

  // Animación de carga
  @keyframes loading-shimmer {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
  }

  // Mejorar el scroll del dropdown
  .ts-dropdown-content {
    @apply max-h-96; // Aumentar altura máxima del dropdown
    @apply overflow-y-auto;
    
    // Estilos personalizados para scrollbar
    scrollbar-width: thin;
    scrollbar-color: #9ca3af #e5e7eb;
    
    &::-webkit-scrollbar {
      width: 6px;
    }
    
    &::-webkit-scrollbar-track {
      background: #f3f4f6;
    }
    
    &::-webkit-scrollbar-thumb {
      background: #9ca3af;
      border-radius: 3px;
    }
    
    &::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }
  }
}

// Override de estilos default de Tom Select que puedan interferir
.ts-wrapper {
  // Eliminar estilos por defecto que no queremos
  &.single .ts-control {
    // Sin padding extra por defecto
    padding-right: 2.5rem; // Espacio para la flecha
    
    &::after {
      // Flecha SVG idéntica a los selects normales
      content: "";
      @apply absolute right-2 top-1/2 transform -translate-y-1/2;
      @apply block w-5 h-5 pointer-events-none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: center;
      background-size: 1rem 1rem;
    }
  }
  
  // Cuando está abierto - flecha hacia arriba
  &.dropdown-active.single .ts-control::after {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%233b82f6' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M14 12l-4-4-4 4'/%3e%3c/svg%3e");
  }
  
  // Cuando está en focus - flecha azul
  &.focus.single .ts-control::after {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%233b82f6' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  }
}
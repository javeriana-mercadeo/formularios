// Phone selector con banderas - estilo compacto y alineado
@use '../vars' as *;

// Elementos con banderas
.phone-prefix-option,
.phone-prefix-item {
  display: flex;
  align-items: center;
  gap: var(--fm-space-2);
  padding: var(--fm-space-1) var(--fm-space-2);
  transition: background-color var(--fm-transition-fast);
  width: 100%;
  box-sizing: border-box;
  overflow: hidden;

  .country-flag {
    width: 18px;
    height: 13px;
    border-radius: var(--fm-radius-sm);
    object-fit: cover;
    flex-shrink: 0;
  }

  .country-code {
    font-weight: var(--fm-font-weight-normal);
    color: var(--fm-text-primary);
    min-width: 40px;
    font-size: var(--fm-font-size-sm);
    flex-shrink: 0;
  }

  .country-name {
    font-size: var(--fm-font-size-select);
    color: var(--fm-text-secondary);
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;
  }
}

.phone-prefix-item {
  padding: 0;
  gap: var(--fm-space-1);

  .country-name {
    display: none;
  }

  .country-code {
    min-width: 35px;
    font-size: var(--fm-font-size-sm);
  }
}

// Selector general de países (para residencia)
.country-option,
.country-item {
  display: flex;
  align-items: center;
  gap: var(--fm-space-3);
  width: 100%;
  box-sizing: border-box;
  overflow: hidden;

  .country-flag {
    width: 24px;
    height: 18px;
    border-radius: var(--fm-radius-sm);
    object-fit: cover;
    flex-shrink: 0;
  }

  .country-name {
    font-size: var(--fm-font-size-sm);
    color: var(--fm-text-primary);
    font-weight: var(--fm-font-weight-normal) !important;
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;
  }
}

// Layout compacto para campos de teléfono - altura exacta
.phone-field-group {
  display: flex;
  align-items: flex-end;
  gap: var(--fm-space-2);
  position: relative;
  margin-bottom: 0;

  .phone-prefix-field {
    flex: 0 0 100px;
    width: 100px;
    max-width: 100px;

    .ts-wrapper {
      .ts-control {
        padding: 10px 6px;
        padding-right: 28px;
        border: none;
        border-bottom: 1px solid var(--fm-input-border-color);
        border-radius: 0;
        background: transparent;
        color: var(--fm-input-text-color);
        font-size: var(--fm-font-size-sm);
        font-weight: var(--fm-font-weight-normal);
        line-height: 1.5;
        box-sizing: border-box;
        outline: none;
        transition: border-bottom-color var(--fm-transition-normal);

        &:focus {
          border-bottom-color: var(--fm-input-border-color-focus);
          border-bottom-width: 2px;
          outline: none;
        }

        &:focus-visible {
          outline: none;
        }
      }

      &:hover:not(.focus):not(.dropdown-active) .ts-control {
        border-bottom-color: var(--fm-input-border-color-hover);
      }

      &.focus .ts-control,
      &.dropdown-active .ts-control {
        border-bottom-color: var(--fm-input-border-color-focus);
        border-bottom-width: 2px;
      }

      // Flecha visible y bien posicionada
      &.single .ts-control::after {
        content: '';
        position: absolute;
        right: 6px;
        top: 50%;
        transform: translateY(-50%);
        width: 18px;
        height: 18px;
        pointer-events: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: center;
        background-size: 18px;
        z-index: 1;
      }

      &.dropdown-active.single .ts-control::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%233e72b9' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M14 12l-4-4-4 4'/%3e%3c/svg%3e");
      }

      .ts-dropdown {
        border: 1px solid var(--fm-border-default);
        border-radius: var(--fm-radius-md);
        box-shadow: var(--fm-shadow-lg);
        background: var(--fm-surface-primary);
        position: absolute;
        left: 0;
        top: 100%;
        margin-top: 2px;
        min-width: 300px;
        max-width: 400px;
        z-index: 1000;
        overflow: visible;

        .ts-control {
          border-bottom: 1px solid var(--fm-border-subtle);
          border-radius: var(--fm-radius-md) var(--fm-radius-md) 0 0;
          background: var(--fm-surface-secondary);
          padding: var(--fm-space-2) var(--fm-space-3);

          .ts-input {
            font-size: var(--fm-font-size-sm);
            font-weight: var(--fm-font-weight-normal);
            color: var(--fm-text-primary);

            &::placeholder {
              color: var(--fm-input-placeholder-color);
              font-weight: var(--fm-font-weight-normal);
              font-size: var(--fm-font-size-sm);
            }
          }
        }

        .ts-dropdown-content {
          max-height: 12rem;
          overflow-y: auto;
          overflow-x: hidden;
          padding: var(--fm-space-1);

          .option {
            padding: var(--fm-space-2);
            margin: 0 0 var(--fm-space-1) 0;
            border-radius: var(--fm-radius-sm);
            transition: background-color var(--fm-transition-fast);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            box-sizing: border-box;

            &:hover,
            &.active {
              background-color: var(--fm-surface-secondary);
            }

            &.selected {
              background-color: var(--fm-interactive-primary);
              color: var(--fm-text-on-primary);
              margin-left: 0;
              margin-right: 0;

              .country-code,
              .country-name {
                color: var(--fm-text-on-primary);
              }
            }
          }
        }
      }
    }
  }

  .phone-number-field {
    flex: 1 1 auto;
    min-width: 0;

    input {
      width: 100%;
      padding: 10px var(--fm-space-1);
      border: none;
      border-bottom: 1px solid var(--fm-input-border-color);
      border-radius: 0;
      background: transparent;
      color: var(--fm-input-text-color);
      font-size: var(--fm-font-size-base);
      font-weight: var(--fm-font-weight-normal);
      line-height: 1.5;
      height: 42px;
      box-sizing: border-box;
      outline: none;
      transition: border-bottom-color var(--fm-transition-normal);

      &:focus {
        border-bottom-color: var(--fm-input-border-color-focus);
        border-bottom-width: 2px;
        outline: none;
      }

      &:focus-visible {
        outline: none;
      }

      &:hover:not(:focus) {
        border-bottom-color: var(--fm-input-border-color-hover);
      }

      &::placeholder {
        color: var(--fm-input-placeholder-color);
        font-weight: var(--fm-font-weight-normal);
      }
    }
  }
}

// Estados de validación consistentes
.field.error {
  .phone-field-group {
    .phone-prefix-field .ts-wrapper .ts-control,
    .phone-number-field input {
      border-bottom-color: var(--fm-input-border-color-error);

      &:focus {
        border-bottom-color: var(--fm-input-border-color-error);
        border-bottom-width: 2px;
      }
    }
  }
}

.field.validated {
  .phone-field-group {
    .phone-prefix-field .ts-wrapper .ts-control,
    .phone-number-field input {
      border-bottom-color: var(--fm-input-border-color-success);

      &:focus {
        border-bottom-color: var(--fm-input-border-color-success);
        border-bottom-width: 2px;
      }
    }
  }
}

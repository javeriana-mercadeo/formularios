<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo - Sistema Modular de Formularios</title>
    
    <!-- Demo page styles (not using the modular system for demo controls) -->
    <style>
      .demo-controls {
        background: #e3f2fd;
        padding: 20px;
        border-radius: 5px;
        margin-bottom: 20px;
        font-family: Arial, sans-serif;
      }

      .demo-controls h3 {
        margin-top: 0;
        color: #1976d2;
      }

      .demo-controls button {
        background-color: #1976d2;
        margin: 5px;
        padding: 8px 16px;
        width: auto;
        font-size: 14px;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .demo-controls button:hover {
        background-color: #1565c0;
      }

      .demo-title {
        font-family: Arial, sans-serif;
        text-align: center;
        color: #333;
        margin-bottom: 20px;
      }

      .demo-info {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        font-family: Arial, sans-serif;
        color: #856404;
      }

      .demo-info h4 {
        margin-top: 0;
        color: #b58900;
      }

      .demo-info code {
        background: #f8f9fa;
        padding: 2px 4px;
        border-radius: 3px;
        font-family: monospace;
      }

      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <h1 class="demo-title">ğŸš€ Demo - Sistema Modular de Formularios</h1>

    <div class="demo-info">
      <h4>ğŸ“‹ InformaciÃ³n del Demo</h4>
      <p>Este formulario utiliza el sistema modular completo con CSS y JavaScript separados. Los estilos se cargan automÃ¡ticamente desde <code>form-modules/styles/</code>.</p>
      <p><strong>CaracterÃ­sticas:</strong></p>
      <ul>
        <li>âœ… CSS modular con importaciÃ³n automÃ¡tica</li>
        <li>âœ… Variables CSS personalizables</li>
        <li>âœ… Temas intercambiables</li>
        <li>âœ… ValidaciÃ³n en tiempo real</li>
        <li>âœ… GestiÃ³n de datos centralizada</li>
      </ul>
    </div>

    <div class="demo-controls">
      <h3>ğŸ”§ Controles de Demo</h3>
      <button onclick="toggleDebugMode()">ğŸ”„ Cambiar Modo Debug</button>
      <button onclick="toggleDevMode()">ğŸ”§ Cambiar Modo Dev</button>
      <button onclick="showStats()">ğŸ“Š Mostrar EstadÃ­sticas</button>
      <button onclick="resetForm()">ğŸ”„ Resetear Formulario</button>
      <button onclick="loadExampleData()">ğŸ“ Cargar Datos de Ejemplo</button>
      <button onclick="toggleTheme()">ğŸ¨ Cambiar Tema</button>
      <button onclick="testCustomStyles()">ğŸ–Œï¸ Probar Estilos Personalizados</button>
    </div>

    <div class="demo-controls">
      <h3>ğŸ“ Controles de Logging</h3>
      <button onclick="toggleLogging()">ğŸ”„ Activar/Desactivar Logs</button>
      <button onclick="setLogLevel('error')">ğŸ”´ Solo Errores</button>
      <button onclick="setLogLevel('warn')">ğŸŸ¡ Errores y Warnings</button>
      <button onclick="setLogLevel('info')">ğŸ”µ Info y Superior</button>
      <button onclick="setLogLevel('debug')">ğŸ” Todos los Logs</button>
      <button onclick="showLogs()">ğŸ“‹ Ver Logs</button>
      <button onclick="clearLogs()">ğŸ—‘ï¸ Limpiar Logs</button>
      <button onclick="exportLogs()">ğŸ’¾ Exportar Logs</button>
      <button onclick="toggleLogPersistence()">ğŸ’¾ Persistir Logs</button>
    </div>

    <div class="container">

      <form id="form_inscription" method="POST" novalidate>
        <!-- InformaciÃ³n del participante -->
        <div class="form-section">
          <div class="name-row">
            <div class="name-field">
              <input
                type="text"
                placeholder="*Nombre(s)"
                id="first_name"
                name="first_name"
                maxlength="40"
                required
              />
              <div class="error_text" id="error_first_name">Completa este campo</div>
            </div>
            <div class="name-field">
              <input
                type="text"
                placeholder="*Apellidos"
                id="last_name"
                name="last_name"
                maxlength="80"
                required
              />
              <div class="error_text" id="error_last_name">Completa este campo</div>
            </div>
          </div>
        </div>

        <!-- Documento de identidad -->
        <div class="form-section">
          <div class="document-row">
            <div class="document-type-field">
              <select id="type_doc" name="type_doc" required>
                <option value="">*Tipo de documento</option>
                <option value="CC">CÃ©dula CiudadanÃ­a</option>
                <option value="CE">CÃ©dula ExtranjerÃ­a</option>
                <option value="PA">Pasaporte</option>
                <option value="TI">Tarjeta Identidad</option>
              </select>
              <div class="error_text" id="error_type_doc">Selecciona un tipo de documento</div>
            </div>
            <div class="document-number-field">
              <input
                type="text"
                placeholder="*NÃºmero de documento"
                id="document"
                name="document"
                maxlength="255"
                required
              />
              <div class="error_text" id="error_document">
                Ingresa un nÃºmero de documento vÃ¡lido
              </div>
            </div>
          </div>
        </div>

        <!-- Email -->
        <div class="form-section">
          <input
            type="email"
            placeholder="*Email"
            id="email"
            name="email"
            maxlength="80"
            required
          />
          <div class="error_text" id="error_email">Ingresa un correo electrÃ³nico vÃ¡lido</div>
        </div>

        <!-- TelÃ©fono -->
        <div class="form-section">
          <div class="phone-row">
            <div class="prefix-field">
              <select id="phone_code" name="phone_code" required>
                <option value="">(+) Indicativo</option>
              </select>
              <div class="error_text" id="error_phone_code">Selecciona un prefijo</div>
            </div>
            <div class="mobile-field">
              <input
                type="text"
                placeholder="*TelÃ©fono celular"
                id="phone"
                name="mobile"
                minlength="8"
                maxlength="15"
                required
              />
              <div class="error_text" id="error_phone">Ingresa un nÃºmero de telÃ©fono vÃ¡lido</div>
            </div>
          </div>
        </div>

        <!-- UbicaciÃ³n -->
        <div class="form-section">
          <select id="country" name="country" required>
            <option value="">*PaÃ­s de residencia</option>
          </select>
          <div class="error_text" id="error_country">Selecciona un paÃ­s</div>

          <select id="department" name="department" style="display: none">
            <option value="">*Selecciona el departamento</option>
          </select>
          <div class="error_text" id="error_department">Selecciona un departamento</div>

          <select id="city" name="city" style="display: none">
            <option value="">*Selecciona la Ciudad</option>
          </select>
          <div class="error_text" id="error_city">Selecciona una ciudad</div>
        </div>

        <!-- Tipo de asistente -->
        <div class="form-section">
          <select id="type_attendee" name="type_attendee" required>
            <option value="">*Tipo de asistente</option>
          </select>
          <div class="error_text" id="error_type_attendee">Selecciona un tipo de asistente</div>
        </div>

        <!-- DÃ­a de asistencia -->
        <div class="form-section">
          <select id="attendance_day" name="attendance_day" required>
            <option value="">*DÃ­a de asistencia</option>
          </select>
          <div class="error_text" id="error_attendance_day">Selecciona un dÃ­a de asistencia</div>
        </div>

        <!-- Facultad -->
        <div class="form-section">
          <select id="faculty" name="Facultad" style="display: none">
            <option value="">*Facultad de interÃ©s</option>
          </select>
          <div class="error_text" id="error_faculty">Selecciona una facultad de interÃ©s</div>
        </div>

        <!-- Programa -->
        <div class="form-section">
          <select id="program" name="program" style="display: none">
            <option value="">*Programa de interÃ©s</option>
          </select>
          <div class="error_text" id="error_program">Selecciona un programa de interÃ©s</div>
        </div>

        <!-- PerÃ­odo de ingreso -->
        <div class="form-section">
          <select id="admission_period" name="admission_period" style="display: none">
            <option value="">*Periodo esperado de Ingreso de interÃ©s</option>
          </select>
          <div class="error_text" id="error_admission_period">Selecciona un periodo de interÃ©s</div>
        </div>

        <!-- AutorizaciÃ³n de datos -->
        <div class="form-section">
          <p style="color: #666">Â¿Autorizas el tratamiento de tus datos personales?</p>

          <div class="radio-inline-group">
            <div class="radio-option">
              <input type="radio" id="autorizacion_si" name="authorization_data" value="1" />
              <label for="autorizacion_si">SÃ­</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="autorizacion_no" name="authorization_data" value="0" />
              <label for="autorizacion_no">No</label>
            </div>
          </div>

          <div class="error_text" id="error_authorization_data">
            Debes autorizar el tratamiento de datos personales para continuar.
          </div>
        </div>

        <button type="submit" id="submit_btn" disabled>InscrÃ­bete ahora</button>

        <div class="success-message" id="successMsg">Gracias por tu mensaje. Ha sido enviado.</div>
      </form>
    </div>

    <script type="module">
      import { FormManager } from "../modules/FormManager.js";

      // ConfiguraciÃ³n del formulario demo
      const demoConfig = {
        eventName: "Demo - Sistema Modular 2025",
        eventDate: "15/03/2025",
        university: "Pontificia Universidad Javeriana",

        typeAttendee: ["Aspirante", "Padre de familia y/o acudiente", "Docente", "Visitante"],

        attendanceDays: ["Viernes 15 de marzo", "SÃ¡bado 16 de marzo", "Domingo 17 de marzo"],

        // ConfiguraciÃ³n para demo
        debugMode: true,
        devMode: true,
        debugEmail: "demo@javeriana.edu.co",

        // UTM tracking
        campaign: "DEMO_2025",
        source: "Demo",
        medium: "Web",

        // ConfiguraciÃ³n de estilos modular
        styles: {
          enabled: true,
          basePath: '../',
          autoLoad: true,
          includeTheme: false,
          themePath: 'styles/themes/custom-theme.css',
          customVariables: {
            'primary-color': '#4d7fcb',
            'primary-hover': '#3f6fb5',
            'form-max-width': '600px'
          }
        },

        // ConfiguraciÃ³n de logging
        logging: {
          enabled: true,
          level: 'debug',
          prefix: 'Demo',
          showTimestamp: true,
          showLevel: true,
          colors: true,
          persistLogs: true,
          maxLogs: 500
        },

        // ConfiguraciÃ³n de validaciÃ³n
        validation: {
          realTimeValidation: true,
          showErrorsOnBlur: true,
        },

        // Callbacks para demo
        callbacks: {
          onFormLoad: (formManager) => {
            console.log("ğŸ“‹ Demo formulario cargado");
            formManager.ui.createNotification("Â¡Formulario demo cargado correctamente!", "success");
          },

          onFormSubmit: async (formData, formManager) => {
            console.log("ğŸš€ Demo - Enviando formulario");
            console.log("ğŸ“Š Datos del formulario:", formData);

            // SimulaciÃ³n de validaciÃ³n personalizada
            if (formData.email && !formData.email.includes("@")) {
              formManager.ui.createNotification("Email debe contener @", "error");
              return false;
            }

            formManager.ui.createNotification("Formulario enviado correctamente (Demo)", "success");
            return true;
          },

          onFieldChange: (fieldName, value, formManager) => {
            console.log(`ğŸ”„ Campo ${fieldName} cambiÃ³ a: ${value}`);
          },
        },
      };

      // Crear instancia del formulario
      const demoForm = new FormManager(demoConfig);

      // Inicializar formulario
      try {
        await demoForm.init();
        console.log("âœ… Demo formulario inicializado");
      } catch (error) {
        console.error("âŒ Error inicializando demo:", error);
      }

      // Funciones globales para los botones de demo
      window.toggleDebugMode = function () {
        const currentMode = demoForm.config.debugMode;
        demoForm.setDebugMode(!currentMode);
        demoForm.ui.createNotification(
          `Modo Debug: ${!currentMode ? "ACTIVADO" : "DESACTIVADO"}`,
          "info"
        );
      };

      window.toggleDevMode = function () {
        const currentMode = demoForm.config.devMode;
        demoForm.setDevMode(!currentMode);
        demoForm.ui.createNotification(
          `Modo Dev: ${!currentMode ? "ACTIVADO" : "DESACTIVADO"}`,
          "info"
        );
      };

      window.showStats = function () {
        const stats = {
          config: demoForm.getConfig(),
          formData: demoForm.getFormData(),
          dataStats: demoForm.dataManager.getDataStats(),
          apiStats: demoForm.apiService.getSubmitStats(),
        };

        console.group("ğŸ“Š EstadÃ­sticas del Demo");
        console.log("âš™ï¸ ConfiguraciÃ³n:", stats.config);
        console.log("ğŸ“ Datos del formulario:", stats.formData);
        console.log("ğŸ’¾ EstadÃ­sticas de datos:", stats.dataStats);
        console.log("ğŸŒ EstadÃ­sticas API:", stats.apiStats);
        console.groupEnd();

        demoForm.ui.createNotification("EstadÃ­sticas mostradas en consola", "info");
      };

      window.resetForm = function () {
        demoForm.reset();
        demoForm.ui.createNotification("Formulario reiniciado", "info");
      };

      window.loadExampleData = function () {
        const exampleData = {
          first_name: "Juan",
          last_name: "PÃ©rez",
          type_doc: "CC",
          document: "1234567890",
          email: "juan.perez@javeriana.edu.co",
          phone_code: "57",
          phone: "3001234567",
          country: "COL",
          type_attendee: "Aspirante",
          attendance_day: "Viernes 15 de marzo",
        };

        demoForm.ui.setFormData(demoForm.formElement, exampleData);
        Object.assign(demoForm.formData, exampleData);

        if (demoForm.ui.createNotification) {
          demoForm.ui.createNotification("Datos de ejemplo cargados", "success");
        } else {
          console.log("âœ… Datos de ejemplo cargados");
        }
      };

      let themeEnabled = false;
      window.toggleTheme = function () {
        themeEnabled = !themeEnabled;
        demoForm.updateConfig({
          styles: {
            ...demoForm.config.styles,
            includeTheme: themeEnabled
          }
        });
        
        if (themeEnabled) {
          demoForm.loadStylesManually({ includeTheme: true });
        } else {
          demoForm.styleLoader.removeStyles('form-theme');
        }
        
        console.log(`ğŸ¨ Tema personalizado: ${themeEnabled ? 'ACTIVADO' : 'DESACTIVADO'}`);
      };

      window.testCustomStyles = function () {
        const customVars = {
          'primary-color': '#e91e63',
          'primary-hover': '#c2185b',
          'form-background': '#fce4ec',
          'form-shadow': '0 8px 32px rgba(233, 30, 99, 0.2)',
          'form-border-radius': '24px'
        };

        demoForm.applyCustomStyles(customVars);
        console.log('ğŸ–Œï¸ Estilos personalizados aplicados:', customVars);
      };

      // Funciones de control de logging
      window.toggleLogging = function() {
        demoForm.toggleLogging();
        const config = demoForm.getLoggingConfig();
        console.log(`ğŸ“ Logging ${config.enabled ? 'HABILITADO' : 'DESHABILITADO'}`);
      };

      window.setLogLevel = function(level) {
        demoForm.setLogLevel(level);
        console.log(`ğŸ“ Nivel de logging cambiado a: ${level}`);
      };

      window.showLogs = function() {
        const logs = demoForm.getLogs();
        const stats = demoForm.getLoggingStats();
        
        console.group('ğŸ“‹ Logs del Sistema');
        console.log('ğŸ“Š EstadÃ­sticas:', stats);
        console.log('ğŸ“ Logs:', logs);
        console.groupEnd();
        
        if (logs.length === 0) {
          console.warn('No hay logs disponibles. Habilita la persistencia de logs primero.');
        }
      };

      window.clearLogs = function() {
        demoForm.clearLogs();
        console.log('ğŸ—‘ï¸ Logs limpiados');
      };

      window.exportLogs = function() {
        const jsonLogs = demoForm.exportLogs('json');
        const csvLogs = demoForm.exportLogs('csv');
        const txtLogs = demoForm.exportLogs('txt');
        
        console.group('ğŸ’¾ Logs Exportados');
        console.log('ğŸ“„ JSON:', jsonLogs);
        console.log('ğŸ“Š CSV:', csvLogs);
        console.log('ğŸ“ TXT:', txtLogs);
        console.groupEnd();
        
        // Crear archivo descargable
        const blob = new Blob([jsonLogs], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `form-logs-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        console.log('ğŸ“ Archivo de logs descargado');
      };

      let logPersistenceEnabled = true;
      window.toggleLogPersistence = function() {
        logPersistenceEnabled = !logPersistenceEnabled;
        demoForm.setLogPersistence(logPersistenceEnabled, 500);
        console.log(`ğŸ’¾ Persistencia de logs ${logPersistenceEnabled ? 'HABILITADA' : 'DESHABILITADA'}`);
      };

      // Agregar listener para logs en tiempo real
      demoForm.addLogListener((logEntry) => {
        // Mostrar logs importantes en la interfaz
        if (logEntry.level === 'error' || logEntry.level === 'warn') {
          // AquÃ­ podrÃ­as mostrar notificaciones en la UI
          console.log(`ğŸ”” Log importante: ${logEntry.message}`);
        }
      });

      // Hacer disponible globalmente para debugging
      window.demoForm = demoForm;
    </script>
  </body>
</html>
